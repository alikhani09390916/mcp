
# معماری سیستم MCP سرور

سیستم MCP سرور در Termux به گونه‌ای طراحی خواهد شد که یک چت‌بات هوش مصنوعی کاملاً مستقل و قدرتمند را برای مدیریت پروژه‌های برنامه‌نویسی و تعامل با کاربر فراهم کند. این سیستم از چندین ماژول اصلی تشکیل شده است که هر یک وظیفه خاصی را بر عهده دارند. هدف اصلی، ایجاد یک محیط تعاملی و خودکار است که بتواند درخواست‌های کاربر را درک کرده، اقدامات لازم را انجام دهد و بازخورد مناسب را ارائه دهد.

## ماژول‌های اصلی:

1.  **ماژول هسته چت‌بات (Chatbot Core Module):**
    *   **وظیفه:** مدیریت مکالمات با کاربر، درک دستورات و سوالات، و تولید پاسخ‌های مناسب.
    *   **اجزا:**
        *   **رابط API Hugging Face:** مسئول برقراری ارتباط با مدل Qwen2-7B-Instruct از طریق API Hugging Face. این بخش درخواست‌ها را به مدل ارسال کرده و پاسخ‌ها را دریافت می‌کند.
        *   **پردازشگر زبان طبیعی (NLP Processor):** وظیفه تحلیل ورودی‌های کاربر (شامل Finglish) و استخراج نیت (intent) و موجودیت‌ها (entities) از آن‌ها را بر عهده دارد. این پردازشگر به چت‌بات کمک می‌کند تا دستورات پیچیده را درک کند.
        *   **مولد پاسخ (Response Generator):** بر اساس نیت شناسایی شده و پاسخ دریافتی از مدل Hugging Face، پاسخ نهایی را برای کاربر تولید می‌کند. این پاسخ‌ها باید شامل راهنمایی‌ها، مثال‌ها و توضیحات لازم باشند.

2.  **ماژول مدیریت پروژه (Project Management Module):**
    *   **وظیفه:** مدیریت چرخه حیات پروژه‌های برنامه‌نویسی، شامل ایجاد، ویرایش، حذف و ذخیره‌سازی پروژه‌ها.
    *   **اجزا:**
        *   **پایگاه داده پروژه (Project Database):** یک سیستم ذخیره‌سازی محلی (احتمالاً فایل‌های JSON یا SQLite) برای نگهداری اطلاعات مربوط به هر پروژه، شامل نام پروژه، وضعیت، فایل‌های مرتبط، و تاریخچه مکالمات.
        *   **مدیریت فایل (File Manager):** قابلیت ایجاد، خواندن، نوشتن، ویرایش و حذف فایل‌ها و دایرکتوری‌ها در محیط Termux. این بخش مسئول دسترسی‌های لازم به سیستم فایل Termux خواهد بود.
        *   **سیستم Resume/Task:** قابلیت ذخیره وضعیت فعلی پروژه و ادامه کار از همان نقطه در صورت قطع شدن یا خروج کاربر. این سیستم باید بتواند پروژه‌های قبلی را شناسایی و به کاربر امکان انتخاب برای ادامه یا شروع پروژه جدید را بدهد.

3.  **ماژول اجرای دستورات (Command Execution Module):**
    *   **وظیفه:** اجرای دستورات لینوکسی و اسکریپت‌های برنامه‌نویسی در محیط Termux.
    *   **اجزا:**
        *   **رابط Shell:** امکان اجرای دستورات Shell و دریافت خروجی آن‌ها. این بخش برای نصب پکیج‌ها، اجرای کدها، و انجام عملیات سیستمی استفاده می‌شود.
        *   **مدیریت خطا (Error Handler):** شناسایی و پردازش خطاهای زمان اجرا، و ارائه بازخورد مناسب به چت‌بات برای اصلاح و تلاش مجدد.

4.  **ماژول رابط کاربری (User Interface Module):**
    *   **وظیفه:** ارائه خروجی‌های رنگی، جدول‌بندی شده و خوانا به کاربر در ترمینال.
    *   **اجزا:**
        *   **فرمت‌بندی خروجی (Output Formatter):** استفاده از کدهای ANSI escape برای رنگی کردن متن، ایجاد جدول‌ها، و فرمت‌بندی کلی خروجی برای بهبود تجربه کاربری.
        *   **سیستم راهنمایی (Help System):** ارائه توضیحات مختصر (short description) و مثال (example) برای هر دستور یا گزینه، به زبان انگلیسی.

5.  **ماژول مدیریت مجوزها و پکیج‌ها (Permissions and Package Management Module):**
    *   **وظیفه:** اطمینان از وجود مجوزهای لازم و نصب پکیج‌های مورد نیاز در Termux.
    *   **اجزا:**
        *   **بررسی مجوزها (Permission Checker):** شناسایی و درخواست خودکار مجوزهای لازم از کاربر در صورت نیاز.
        *   **مدیریت پکیج (Package Manager):** قابلیت نصب، به‌روزرسانی و حذف پکیج‌های Termux (مانند `apt` یا `pip`) به صورت خودکار.

## جریان کار کلی:

1.  **شروع سیستم:** کاربر اسکریپت MCP سرور را در Termux اجرا می‌کند.
2.  **بررسی پروژه‌های قبلی:** سیستم بررسی می‌کند که آیا پروژه‌های ناتمام یا قبلی وجود دارد یا خیر. اگر وجود داشته باشد، از کاربر می‌پرسد که آیا قصد ادامه دادن، ویرایش یا شروع پروژه جدید را دارد.
3.  **دریافت دستور:** کاربر دستور یا سوال خود را (به صورت Finglish یا انگلیسی) وارد می‌کند.
4.  **پردازش دستور:** ماژول هسته چت‌بات، دستور را تحلیل کرده و نیت کاربر را شناسایی می‌کند.
5.  **اجرای عملیات:** بر اساس نیت کاربر، ماژول‌های مربوطه (مدیریت پروژه، اجرای دستورات) فراخوانی می‌شوند.
6.  **تعامل با Hugging Face API:** در صورت نیاز به تولید پاسخ‌های پیچیده یا برنامه‌نویسی، درخواست به مدل Qwen2-7B-Instruct ارسال می‌شود.
7.  **مدیریت خطا و بازخورد:** در صورت بروز خطا، ماژول مدیریت خطا آن را پردازش کرده و به چت‌بات اطلاع می‌دهد تا راه حل مناسب را ارائه دهد یا تلاش مجدد کند.
8.  **نمایش خروجی:** ماژول رابط کاربری، خروجی‌های رنگی و فرمت‌بندی شده را در ترمینال نمایش می‌دهد.
9.  **ذخیره وضعیت:** وضعیت پروژه به صورت مداوم ذخیره می‌شود تا قابلیت Resume فراهم باشد.
10. **پایان کار:** پس از اتمام پروژه یا خروج کاربر، سیستم وضعیت را ذخیره کرده و آماده شروع مجدد می‌شود.

این معماری، یک پایه قوی برای توسعه یک سیستم MCP سرور هوشمند و کارآمد در Termux فراهم می‌کند. در مراحل بعدی، به جزئیات پیاده‌سازی هر یک از این ماژول‌ها خواهیم پرداخت.

